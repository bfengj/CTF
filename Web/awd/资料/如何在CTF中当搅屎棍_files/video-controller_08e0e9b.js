define("@baidu/video-controller/lib/videoController",["@searchfe/user-agent","@baidu/boxx","@baidu/splayer","@baidu/webb","versions-compare","@baidu/video-decoder-player"],function(e,t,i,n,o,r){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){
var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){var e=!1,t=!1,i=!1,n=0,o=!1
;return window.page&&window.page.comm&&window.page.comm.sampleval&&(e="1"===window.page.comm.sampleval.VIDEO_NEW_PLAY_RULES,t="1"===window.page.comm.sampleval.VIDEO_A2C_TRANSITION,i="1"===window.page.comm.sampleval.VIDEO_NA,n=+window.page.comm.sampleval.VIDEO_PLAY_RULES_RATIO||0,o=1==+window.page.comm.sampleval.VID_VIVO_AUTOPLAY,window.page.comm.sampleval.NOTE_SAMELAYER_PLAYER),{VIDEO_NEW_PLAY_RULES:e,VIDEO_A2C_TRANSITION:t,VIDEO_NA:i,VIDEO_PLAY_RULES_RATIO:n,VIDEO_VIVO_AUTOPLAY:o}}
function h(e,t,i,n,o){var r=y()===b.NOTE;if(C&&!r){var a=t[i],s=t[n];if(a!==s)return a>s;if(o&&o===i)return!0;if(o&&o===n)return!1}var l=e[i].options.container,d=e[n].options.container,u=l.getBoundingClientRect(),c=d.getBoundingClientRect();return u.top===c.top?u.left<c.left:u.top<c.top}function p(e){var t=e.parentElement;if(!t||"results"===t.id||"BODY"===t.nodeName)return"";var i=t.getAttribute("tpl");if(i){var n="";return"lego_tpl"===i&&(n=t.getAttribute("legoid")),i+(n?"_"+n:"")}return p(t)}
function f(){var e=/\/s$/.test(window.location.pathname);return window.hasBoxLgFloor?!window.ssIsPaused&&!window.ss_webview_is_in_background&&0===window.boxLgFloorStatus:!(T.default.isBaiduBox()&&!T.default.isBaiduBoxJisu()&&e&&(window.ssIsPaused||window.ss_webview_is_in_background))}function v(e){return e.closest("[srcid]")}function y(){var e,t,i;return"note"===(null==(e=window)||null==(t=e.page)||null==(i=t.comm)?void 0:i.pd)?b.NOTE:b.NORMAL}function I(){
return document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop}function m(e){"wifi"!==D&&"unknown"!==D&&e&&null!=S.default&&S.default.canIUse("search.showMobileNetPushVideoSettingPageToast")&&S.default.search.showMobileNetPushVideoSettingPageToast(e)}function w(){return Promise.all([(e="unknown",new Promise(function(t){null!=S.default&&S.default.canIUse("device.getNetworkType")?S.default.device.getNetworkType({success:function(i){var n
;D=null!=i&&null!=(n=i.data)&&n.networkType?i.data.networkType:e,t(D)},fail:function(){t(D=e)}}):t(D=e)})),new Promise(function(e){null!=S.default&&S.default.canIUse("search.getWifiVideoAutoplaySwitchType")?S.default.search.getWifiVideoAutoplaySwitchType({success:function(t){var i;e(!(null==t||null==(i=t.data)||!i.value)&&1==+t.data.value)},fail:function(){e(!0)}}):e(!0)}),new Promise(function(e){
null!=S.default&&S.default.canIUse("search.getMobileNetVideoAutoplaySwitchType")?S.default.search.getMobileNetVideoAutoplaySwitchType({success:function(t){var i;e(!(null==t||null==(i=t.data)||!i.value)&&1==+t.data.value)},fail:function(){e(!0)}}):e(!0)})]).then(function(e){var t=e[0],i=e[1],n=e[2];return k="wifi"===t?i?1:0:n?1:0});var e}function V(){ee&&f()&&(ee=!1,he.hasLeaveState=!1,w().then(function(e){var t=he.currentVideoInstance;if(t){
var i=t.options,n=i.vid,o=i.pageUrl,r=$&&ae&&N.default(T.default.baiduBoxVersion(),"13.20")>=0;(function(e,t,i){return void 0===i&&(i=!1),new Promise(function(n,o){null!=S.default&&S.default.canIUse("media.video.readVideoHistoryPlayerInfo")&&!i&&e&&t?S.default.media.video.readVideoHistoryPlayerInfo({vid:e,pageUrl:t,success:function(e){try{n({vid:e.data.vid,progress:String(e.data.progress)})}catch(e){o(e)}}}):o()})})(n,o,r&&se).then(function(i){setTimeout(function(){ee||(t&&e&&t.videoAutoplay(),
t&&n===i.vid&&(t.currentTime=he.isNoteController?0:i.progress))},500)}).catch(function(){if(t.isAutoplayType()){var i=T.default.isAndroid()&&ae&&N.default(T.default.baiduBoxVersion(),"13.20")>=0;if($&&i)return;Z&&"0"===window.h5VideoFocusStatus||(he.isNoteController&&t&&(t.currentTime=0),t&&e&&t.videoAutoplay())}else if(T.default.isBaiduBox()){var n=-1;if(!he.isNoteController&&t&&t.isPreviewType()){var o=he.inviewVideoIds.indexOf(t.videoId)-1;o>=0&&(n=he.inviewVideoIds[o])}setTimeout(function(){
ee||(he.isNoteController&&t&&(t.currentTime=0),t&&t.play(),!he.isNoteController&&he.findNextPlayVideo(n))},300)}else setTimeout(function(){if(t&&t.isPreviewType()&&t.paused){if(ee)return;he.isNoteController&&t&&(t.currentTime=0),t.play()}},500)}).finally(function(){se=!1})}else he.findNextPlayVideo()}))}function g(){if(!ee){ee=!0,he.hasLeaved=!0,he.hasLeaveState=!0;var e,t=he.currentVideoInstance;if(t){var i=t.options,n=i.vid,o=i.pageUrl,r=i.container
;t.isPreviewType()&&(he.nextPlayVideoId=he.nextPlayVideoId||t.videoId),n&&o&&function(e,t,i){e&&t&&null!=S.default&&S.default.canIUse("media.video.saveVideoHistoryPlayerInfo")&&null!=S.default&&S.default.canIUse("media.video.seekPlayer")&&(S.default.media.video.saveVideoHistoryPlayerInfo({vid:e,pageUrl:t,progress:String(Math.ceil(i)||0)}),S.default.media.video.seekPlayer({vid:e,pageUrl:t,seek:String(Math.ceil(i)||0)}))}(n,o,t.currentTime||0)
;var a=ae&&N.default(T.default.baiduBoxVersion(),"13.18")>=0;if($&&a){var s=v(r),l=(null==s?void 0:s.getAttribute("data-video-link-id"))||"",d=null==s?void 0:s.getAttribute("data-link-jumping");e=document.body.querySelectorAll("[data-link-jumping], [data-video-link-id]"),Array.from(e).forEach(function(e){e.removeAttribute("data-link-jumping"),e.removeAttribute("data-video-link-id")}),!(se=!!d&&l===n)&&t.pause()}else t.pause()}}}function P(){
window.ssIsPaused||window.ss_webview_is_in_background?g():V()}function E(){window.hasBoxLgFloor&&window.addEventListener("boxLgFloorChanged",function(e){var t=e.status,i=he.currentVideoInstance;0!==t||ee?i&&i.pause():i?i.videoAutoplay():he.findNextPlayVideo()}),window.addEventListener("bbabeepagewillactive",function(){V()}),window.addEventListener("bbabeepagewillinactive",function(){g()}),document.addEventListener("visibilitychange",function(){document.hidden?g():V()}),
window.addEventListener("pageshow",function(){V()}),window.addEventListener("pagehide",function(){g()}),window.addEventListener("beforeunload",function(){g()}),window.addEventListener("unload",function(){g()});var e=document.querySelector("[id^=vid_js_bridge]");e&&e.contentWindow.addEventListener("message",P),$&&window.addEventListener("message",function(e){var t=e.data;null!=t&&t&&"object"==typeof t&&"type"in t&&"action"in t&&"mediaAction"===t.type&&"resumeMedia"===t.action&&V()});var t=!X
;window.addEventListener("touchstart",function(){t=!X||!(!T.default.isIOS()||!T.default.isBaiduBox()),oe=Date.now(),re=window.scrollY}),window.addEventListener("scroll",function(){if(he.hasScrolled||(he.hasScrolled=!0),X&&T.default.isIOS()&&T.default.isBaiduBox()&&Date.now()-oe>=100){var e=1e3*Math.abs(window.scrollY-re)/(Date.now()-oe);oe=Date.now(),re=window.scrollY,e<200&&(t=!1,he.setScrolling(!1))}if(te||(t&&he.setScrolling(!0),X&&(ie=ne=window.scrollY,he.pageScrollStart())),X){
var i=window.scrollY,n=ne-ie,o=i-ne;0!==n&&0!==o&&n>0!=o>0&&(ie=i),ne=i;var r=i-ie;r>42?he.pageScrollUp():r<-42&&he.pageScrollDown()}clearTimeout(te),te=setTimeout(function(){t&&he.setScrolling(!1),te=null},t?200:50)}),Z&&(window.addEventListener("onNaVideoFocusChanged",function(e){var t=he.currentVideoInstance;+e.hasFocus?he.findNextPlayVideo():(t&&t.destroy(),he.setCurrentVideoInstance(null))}),document.addEventListener("onLinkageScroll",function(e){
var t=e.detail.offset/window.devicePixelRatio,i=e.detail.state;he.updateLinkageScrollOffset(t,+i)}))}var b,T=a(e),S=a(t),A=a(i),O=a(n),N=a(o);!function(e){e.NORMAL="normal",e.NOTE="note"}(b||(b={}));var L,_=c(),C=_.VIDEO_NEW_PLAY_RULES,x=_.VIDEO_VIVO_AUTOPLAY,R=T.default.isBaiduboxOrBdapp()||T.default.isGoogleChrome()||T.default.isSafariBrowser()||T.default.isBDBoxEngine()||x,D="",k=-1,F=function(){function e(){s(this,"es",{})}var t=e.prototype;return t.on=function(e,t,i){
return void 0===i&&(i=!1),this.es[e]||(this.es[e]=[]),this.es[e].push({cb:t,once:i}),this},t.once=function(e,t){return this.on(e,t,!0),this},t.emit=function(e){for(var t=this.es[e]||[],i=t.length,n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];for(var a=0;a<i;a++){var s=t[a],l=s.cb,d=s.once;l.apply(this,o),d&&(t.splice(a,1),a--,i--)}return this},t.off=function(e,t){
if(void 0===e)this.es={};else if(void 0===t)delete this.es[e];else for(var i=this.es[e]||[],n=i.length,o=0;o<n;o++)i[o].cb===t&&(i.splice(o,1),o--,n--);return this},e
}(),B=["autoplay","buffered","crossOrigin","currentSrc","currentTime","defaultMuted","duration","ended","error","loop","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","volume","fullScreen","needReadLocalProgress","ignore4gToast","seekSeconds","videoGravity","syncPlayerCacheProgress","isIgnoreDeviceOrientation"],U=["playBtnClicked","voiceBtnClicked","rateBtnClicked","barrageSwitchChanged","pointTouchStart","pointTouchMove","pointTouchEnd","fullScreen","click","destroy","successPlay","touchstart","init","ready","reset","prepare","play","pause","ended","error","closed","canplay","timeupdate","volumechange","mutedchange","loadingchange","cachetimechange","cacheloadfinished","ratechange","startnextloop","enterfullscreen","exitfullscreen","netchange","controlhiddenchange","enterpictureinpicture","suspenseclick","leavepictureinpicture","closesuspense","enterpip","closepip","pipclick","pipfail","abort","canplaythrough","durationchange","emptied","loadeddata","loadstart","playing","progress","seeked","seeking","stalled","suspend","waiting"],Y=["destory","ended","play","playing","pause"],W=["customPlugins","plugins","mimetype","type","decoderSwitch"],j=["autoplay","preview"],M=c(),Q=M.VIDEO_NEW_PLAY_RULES,G=M.VIDEO_NA,H=M.VIDEO_PLAY_RULES_RATIO,q=M.NOTE_SAMELAYER_PLAYER,K=(L={
pid:"1_5",lid:(new Date).getTime(),pf_comm:{sample:.01},count_comm:{sample:.001}},-1!==document.cookie.indexOf("webbtest=1")&&["pf_comm","count_comm"].forEach(function(e){L[e].sample=1}),new O.default(L)),J=function(e){function t(t,i){var n;return s(u(n=e.call(this)||this),"isNoteController",he.isNoteController),s(u(n),"player",null),s(u(n),"status",""),s(u(n),"type","none"),s(u(n),"videoId",0),s(u(n),"options",{}),s(u(n),"hasPlayed",!1),s(u(n),"defaultRatio",n.isNoteController?H||.7:Q?.3:.7),
s(u(n),"lastTime",0),s(u(n),"prepareStartTime",0),s(u(n),"prepareEndTime",0),s(u(n),"isFirstPlay",!0),s(u(n),"videoUpdate",!1),s(u(n),"showRatio",0),s(u(n),"findInstanceDuration",-1),s(u(n),"perfInfo",{}),s(u(n),"playerIsReady",!1),i.container?(n.videoId=t,n.type=i.playType||"none",n.initData(i),n.addObserver(),n.sendCountWebbLog(),n):u(n)}var i,n;n=e,(i=t).prototype=Object.create(n.prototype),i.prototype.constructor=i,d(i,n);var o=t.prototype;return o.sendCountWebbLog=function(){
var e,t,i=p(this.options.container),n=T.default.isBaiduBox()?"baidubox":"other",o=v(this.options.container),r=o&&function(e,t){var i=t||document.body,n=e.closest("a");if(n&&n.getAttribute("href"))return n;for(var o=null,r=e;r&&r!==i;){var a=r.hasAttribute("rl-node"),s=r.getAttribute("rl-type"),l=r.getAttribute("rl-link-href");if("stop"===s||"button"===s)break;if(a&&l){o=r;break}r=r.parentNode}return o
}(this.options.container,o),a=(null==r?void 0:r.getAttribute("data-click"))||(null==r?void 0:r.getAttribute("rl-link-data-click")),s=null;try{s=a&&JSON.parse(a)}catch(e){s={}}var l=["video_na","video_jsy","xsp_na","xsp_jsy"].indexOf(null==(e=s)||null==(t=e.clk_info)?void 0:t.jumpType)>-1;i&&K.send("count_comm",{count:1},{tplName:i,browser:n,isVideoLink:l,playType:this.type},null,{group:"videoControlCount"})},o.canAutoPlay=function(e){
return!this.isForbidPlayType()&&(this.isNoteController?!(!this.isPreviewType()&&!this.isAutoplayType()||this.hasPlayed):!!(this.isPreviewType()||this.isAutoplayType()&&!this.hasPlayed)&&(!e||e.contains(this.options.container)))},o.addObserver=function(){this.options.container.setAttribute("data-video-id",String(this.videoId)),he.intersectObserver.observe(this.options.container)},o.isAutoplayType=function(){return"autoplay"===this.type},o.isPreviewType=function(){return"preview"===this.type},
o.isForbidPlayType=function(){var e=this.options.allBrowserCanPlay||R||this.options.decoderSwitch&&this.options.isWasmPlayerSupport;return!this.type||"none"===this.type||!e},o.destroy=function(e){e&&(this.hasPlayed=!1,this.videoUpdate=!1),this.player&&(!this.isNoteController&&this.isAutoplayType()&&(this.player.duration-this.player.currentTime<1?this.lastTime=0:this.lastTime=this.player.currentTime||0),void 0!==this.player.muted&&(this.options.muted=this.player.muted),this.player.destroy(),
this.player=null,this.playerIsReady=!1)},o.switchVideo=function(e){if(this.options=Object.assign(this.options,e),e.mpd||(this.options.mpd=""),e.clarityUrl||(this.options.clarityUrl=""),this.player){this.videoUpdate=!0,this.hasPlayed=!1,this.emit("beforePlay");var t=this.filterOptions(),i=t.videoData,n=t.playerOption;this.player.currentTime=i.currentTime||0,this.player.resetVideo(i,n)}else this.destroy(),this.play()},o.videoAutoplay=function(){var e=this
;f()&&(G&&"0"===window.h5VideoFocusStatus||(-1===k?w().then(function(t){e.emit("mobileNetAutoplaySwitch",t),(t>0||!e.isNoteController&&e.isPreviewType())&&(e.play(),m(e.options.naNetToastParams))}):(this.emit("mobileNetAutoplaySwitch",k),(k>0||!this.isNoteController&&this.isPreviewType())&&(this.play(),m(this.options.naNetToastParams)))))},o.play=function(){if(this.hasPlayed=!1,he.currentVideoInstance&&he.currentVideoInstance.videoId!==this.videoId)he.priorityPlay(this.videoId);else{
this.emit("beforePlay");var e=!1;if(this.player&&(e="SAMELAYER_PLAYER"===this.player.type?this.player:this.player.video),!e||"destroy"===this.status)return this.initPlayer(),this.player;this.player.play()}},o.pause=function(){this.player&&this.player.pause()},o.load=function(){this.player&&this.player.load()},o.enterFullscreen=function(){this.player&&this.player.enterFullscreen()},o.exitFullscreen=function(){this.player&&this.player.enterFullscreen()},o.enterSuspense=function(){
this.player&&this.player.enterFullscreen()},o.exitSuspense=function(){this.player&&this.player.enterFullscreen()},o.registryPlugin=function(){this.player&&this.player.enterFullscreen()},o.registryPlugins=function(){this.player&&this.player.enterFullscreen()},o.setOption=function(e,t){this.options[e]=t,this.isNoteController||"currentTime"!==e||(this.lastTime=t)},o.setLoop=function(){var e=he.inviewVideoIds.filter(function(e){return he.allInstance[e].canAutoPlay()});if(this.player){
var t=this.isNoteController?e[0]===this.videoId&&1===e.length:this.isPreviewType()&&e[0]===this.videoId&&1===e.length||this.player.loop;this.player.loop=!!t}},o.initPlayer=function(){var e=this,t=this.filterOptions(),i=t.videoData,n=t.playerOption;i.playType="autoplay",i.autoplay=!0,this.player=new A.default(i,n),this.proxyEvent(),this.setProps(),this.player.on("successPlay",function(){return e.isFirstPlay=!1})},o.filterOptions=function(){var e=Object.assign({},this.options)
;T.default.isBaiduBox()||T.default.isUC()||T.default.isTomas()||(e.muted=!0),e.videoContainer&&(e.container=e.videoContainer),this.lastTime&&(e.currentTime=this.lastTime||0),["playType","intersectionOption","naNetToastParams"].forEach(function(t){delete e[t]}),this.showRatio=he.allVideoInterViewRatio[this.videoId];var t={extra:l({},e.extra,{lastTime:this.lastTime,isFirstPlay:this.isFirstPlay,pfLog:{},network:D,showRatio:this.showRatio,perfInfo:this.perfInfo})}
;return this.findInstanceDuration>0&&(t.extra.pfLog.findInstanceDuration=this.findInstanceDuration),this.prepareStartTime>0&&(t.extra.pfLog.instancePrepareDuration=Date.now()-this.prepareStartTime),this.findInstanceDuration=-1,this.prepareStartTime=-1,W.forEach(function(i){t[i]=e[i],delete e[i]}),{videoData:e,playerOption:t}},o.playEnd=function(){var e=this
;document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||this.player.loop||(this.hasPlayed=!0,this.lastTime=0,this.options.currentTime=0,this.videoUpdate=!1,setTimeout(function(){e.videoUpdate||(e.destroy(),he.findNextPlayVideo(e.videoId))}))},o.setProps=function(){var e=this;B.forEach(function(t){Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return this.player&&this.player[t]},set:function(e){
this.player&&(this.player[t]=e,this.isNoteController||"currentTime"!==t||(this.lastTime=e))}})})},o.initData=function(e){var t=e.intersectionOption,i=e.naNetToastParams,n=(this.isNoteController&&q?null:e.type)||(this.isPreviewType()&&(!T.default.isBaiduBox()||T.default.isBaiduBox()&&T.default.isAndroid()&&N.default(T.default.baiduBoxVersion(),"13.27")<0)?"NATIVE_PLAYER":"SAMELAYER_PLAYER");this.isNoteController&&(e.muted=!0,"SAMELAYER_PLAYER"===n&&(e.isIgnoreVolumeChange=!0,
e.audioGroupScope="NOTE")),this.options=l({},e,{autoplay:"none"!==this.type,t7PlayerType:this.isPreviewType()?"inline":e.t7PlayerType||"",type:n,intersectionOption:{ratio:"number"==typeof(null==t?void 0:t.ratio)?t.ratio:this.defaultRatio},naNetToastParams:Object.assign({pageId:"search_result_page",bussiness:"sfe_default_video"},i),playType:this.type}),1===this.options.intersectionOption.ratio&&(this.options.intersectionOption.ratio=.99)},o.proxyEvent=function(){var e=this;U.forEach(function(t){
!function(e){var t=e.selector,i=e.eventName,n=e.fn,o=e.context;t.off(i).on(i,function(e){n.apply(o,[e])})}({selector:e.player,eventName:t,fn:function(i){Y.indexOf(t)>-1&&(e.status=t),"ended"===t&&e.playEnd(),"successPlay"===t&&(he.clearPriority(),e.lastTime&&!e.isPreviewType()||e.emit("videoStart"),e.setLoop(),e.lastTime&&e.isAutoplayType()&&(e.player.currentTime=e.lastTime),e.videoUpdate&&(e.player.currentTime=e.options.currentTime||0)),"enterpictureinpicture"===t&&he.setControllerEnable(!1),
"leavepictureinpicture"===t&&he.setControllerEnable(!0),e.emit(t,i)},context:e})})},t}(F),z=c(),X=z.VIDEO_NEW_PLAY_RULES,$=z.VIDEO_A2C_TRANSITION,Z=z.VIDEO_NA,ee=!1,te=null,ie=0,ne=0,oe=0,re=0,ae=T.default.isBaiduBox()&&!T.default.isBaiduBoxLite()&&!T.default.isBaiduBoxJisu(),se=!1,le=c().VIDEO_NEW_PLAY_RULES;w();var de,ue,ce=!1;!function(e){e.INSTANCECHANGE="INSTANCECHANGE"}(de||(de={})),function(e){e[e.INITIAL_SCROLL=0]="INITIAL_SCROLL",e[e.LINKAGE_SCROLL=1]="LINKAGE_SCROLL",
e[e.WEBVIEW_SCROLL=2]="WEBVIEW_SCROLL"}(ue||(ue={}));var he=new(function(){function e(){s(this,"controllerEnable",!0),s(this,"allInstance",{}),s(this,"focusedParentDom",null),s(this,"isScroll",!1),s(this,"nextPlayVideoId",0),s(this,"currentVideoInstance",null),s(this,"intersectObserver",this.createIntersectionObserver()),s(this,"inviewVideoIds",[]),s(this,"videoId",0),s(this,"isWasmPlayerSupport",r.support()),s(this,"allVideoInterViewRatio",{}),s(this,"beforeScrollVideoId",0),
s(this,"canPlayQueue",{}),s(this,"hasScrolled",!1),s(this,"hasLeaved",!1),s(this,"hasLeaveState",!1),s(this,"linkageScrollState",ue.INITIAL_SCROLL),s(this,"initialEntries",[]),s(this,"isNoteController",y()===b.NOTE),s(this,"events",new Map),s(this,"isFirstVideo",!0),s(this,"hasFsv",!1),s(this,"prerenderProcessed",!1),s(this,"fpAutoPlayEl",null),s(this,"findNextPlayVideo",le?this.newFindNextVideo:function(e,t){var i=null,n=this,o=0;return function(){
for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];clearTimeout(i),0===o?(e.apply(n,r),o++):i=setTimeout(function(){e.apply(n,r),o++},100)}}(this.newFindNextVideo.bind(this))),this.initFpAutoPlay()}var t=e.prototype;return t.setControllerEnable=function(e){void 0===e&&(e=!0),this.controllerEnable=e},t.initFpAutoPlay=function(){var e=this,t=window.screen,i=t.width,n=t.height,o=I(),r=Number.MAX_VALUE,a=Number.MAX_VALUE;j.forEach(function(t){
Array.prototype.forEach.call(document.querySelectorAll('[data-video-play-type="'+t+'"]'),function(t){var s=t.getBoundingClientRect(),l=s.top,d=s.left;l<r&&d<a&&l>o&&l<=o+n&&d<=i&&(e.fpAutoPlayEl=t,r=l,a=d)})}),this.fpAutoPlayEl&&setTimeout(function(){e.fpAutoPlayEl&&(e.fpAutoPlayEl=null,e.newFindNextVideo())},2500)},t.updateFpAutoPlay=function(e){if(this.fpAutoPlayEl&&e){for(var t=e;t&&!(j.indexOf(t.getAttribute("data-video-play-type")||"")>-1);)t=t.parentElement
;t&&this.fpAutoPlayEl===t&&(this.fpAutoPlayEl=null)}},t.resetIntersectObserver=function(e){void 0===e&&(e={});var t=this.intersectObserver;for(var i in this.intersectObserver=this.createIntersectionObserver(e),this.allInstance){var n=this.allInstance[i].options.container;t.unobserve(n),this.intersectObserver.observe(n)}},t.createIntersectionObserver=function(e){var t=this;return void 0===e&&(e={}),new IntersectionObserver(function(e){t.controllerEnable&&(t.setInviewList(e),t.findNextPlayVideo())
},l({threshold:le?[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,.99,1]:[0,.5,.7,.9,.99,1]},e))},t.createInstance=function(e){ce||(ce=!0,E()),e.isWasmPlayerSupport=this.isWasmPlayerSupport,e.initPlayer=+new Date;var t=e||{},i=t.playType,n=t.container;j.indexOf(i||"")>-1&&this.updateFpAutoPlay(n);var o=new J(++this.videoId,e);if(o.videoId)return this.allInstance[this.videoId]=o,this.addInviewKey(o.videoId),o},t.setScrolling=function(e){this.isScroll=e,e||this.findNextPlayVideo()},t.resetParentDom=function(){
var e=this;!this.isScroll&&this.focusedParentDom&&!this.inviewVideoIds.some(function(t){var i;return null==(i=e.focusedParentDom)?void 0:i.contains(e.allInstance[t].options.container)})&&this.clearPriority()},t.raisePriority=function(e){this.focusedParentDom=e,this.findNextVideoId()<=0&&(this.focusedParentDom=null),this.findNextPlayVideo()},t.clearPriority=function(){this.focusedParentDom=null},t.priorityPlay=function(e){var t=this
;this.currentVideoInstance&&this.currentVideoInstance.videoId===e||(this.clearPriority(),this.currentVideoInstance&&this.currentVideoInstance.destroy(),this.setCurrentVideoInstance(this.allInstance[e]),setTimeout(function(){t.currentVideoInstance&&t.currentVideoInstance.play()}))},t.updateToNextVideoInstance=function(){var e,t=this.findNextVideoId(null==(e=this.currentVideoInstance)?void 0:e.videoId);t>-1&&(this.nextPlayVideoId=t)},t.newFindNextVideo=function(e){var t=this
;if(!this.fpAutoPlayEl&&!this.hasLeaveState&&!this.isScroll)if("0"!==window.h5VideoFocusStatus){this.resetParentDom();var i=0;if(this.nextPlayVideoId?(i=this.nextPlayVideoId,this.nextPlayVideoId=0):i=this.findNextVideoId(e),i<=0)for(var n in this.allInstance)this.allInstance[n].startFindInstanceTime=-1;else{if(this.currentVideoInstance){if(this.currentVideoInstance.videoId===i){for(var o in this.currentVideoInstance.setLoop(),this.allInstance)this.allInstance[o].startFindInstanceTime=-1;return}
this.currentVideoInstance&&this.currentVideoInstance.destroy()}for(var r in this.setCurrentVideoInstance(this.allInstance[i]),this.currentVideoInstance.prepareStartTime=Date.now(),this.currentVideoInstance.startFindInstanceTime>0&&(this.currentVideoInstance.findInstanceDuration=Date.now()-this.currentVideoInstance.startFindInstanceTime),this.currentVideoInstance.perfInfo=this.collectPerf(this.currentVideoInstance),this.isFirstVideo&&(this.isFirstVideo=!1),
this.allInstance)this.allInstance[r].startFindInstanceTime=-1;this.processPrerenderVideo(),setTimeout(function(){t.currentVideoInstance&&t.currentVideoInstance.videoAutoplay()})}}else this.currentVideoInstance&&this.currentVideoInstance.destroy()},t.registerEvent=function(e,t){if(t){var i=this.events.has(e),n=this.events.get(e)||new Set;n.add(t),i||this.events.set(e,n)}},t.dispatch=function(e,t){var i=this.events.get(e);i&&Promise.resolve().then(function(){i.forEach(function(e){e(t)})})},
t.setCurrentVideoInstance=function(e){this.currentVideoInstance=e,this.dispatch(de.INSTANCECHANGE,e)},t.processPrerenderVideo=function(){var e=this;this.prerenderProcessed||(this.prerenderProcessed=!0,Object.keys(this.allInstance).forEach(function(t){var i,n=e.allInstance[t];if(n!==e.currentVideoInstance){var o=null==n||null==(i=n.options)?void 0:i.container;if(o&&o.querySelector("[class^=h5-samelayer-cid-]"))try{n.videoAutoplay(),n.emit("prerenderDestroy"),n.destroy()}catch(e){}}}))},
t.collectPerf=function(e){var t,i,n,o=null==e||null==(t=e.options)||null==(i=t.container)?void 0:i.querySelector("[class^=h5-samelayer-cid-]"),r=this.hasScrolled||I()>0,a=[];if(!this.hasFsv&&!r&&this.isFirstVideo&&!this.hasLeaved&&!o&&null!=(n=window.performance)&&n.timing){var s=window.performance.timing;a=[{key:"startSearch",value:s.navigationStart},{key:"firstPackage",value:s.responseStart},{key:"upScreen",value:s.domInteractive}]}var l=+new Date;return{page:a,player:[{key:"prepare",
value:e.startFindInstanceTime>0?e.startFindInstanceTime:l},{key:"queryInstance",value:l}]}},t.findNextVideoId=function(e){for(var t=e?this.inviewVideoIds.indexOf(e):-1,i=this.inviewVideoIds.concat(this.inviewVideoIds),n=t+1;n<=i.length;n++){var o=i[n];if(o&&this.allInstance[o]&&this.allInstance[o].canAutoPlay(this.focusedParentDom)&&(this.isNoteController||!le||this.canPlayQueue[o]))return o}return 0},t.addInviewKey=function(e){var t=this
;if(!(this.inviewVideoIds.indexOf(e)>-1))if(!le||this.isNoteController){var i=this.inviewVideoIds.findIndex(function(i){var n;return h(t.allInstance,t.allVideoInterViewRatio,e,i,null==(n=t.currentVideoInstance)?void 0:n.videoId)});-1===i?this.inviewVideoIds.push(e):this.inviewVideoIds.splice(i,0,e)}else this.inviewVideoIds.push(e)},t.setVideoInterViewRatio=function(e,t){this.allVideoInterViewRatio[e]=t>.99?1:+t.toFixed(2)},t.updateLinkageScrollOffset=function(e,t){var i=this
;if(this.allVideoInterViewRatio){var n=window.innerHeight-e;if(this.linkageScrollState!==ue.WEBVIEW_SCROLL&&t===ue.WEBVIEW_SCROLL&&this.setInviewList(this.initialEntries),this.linkageScrollState=t,this.linkageScrollState!==ue.WEBVIEW_SCROLL){var o=Object.keys(this.allVideoInterViewRatio).map(function(e){var t=i.allInstance[+e];t.rect||(t.rect=t.options.container.getBoundingClientRect());var o=t.rect,r=o.height,a=o.top,s=0,l=0;return a-n<0&&(l=r>(s=n-a)?s/r:1),{boundingClientRect:t.rect,
intersectionRatio:l,intersectionRect:t.rect,isIntersecting:l>0,rootBounds:null,target:t.options.container,time:Date.now()}});this.setInviewList(o),this.findNextPlayVideo()}}},t.setInviewList=function(e){var t=this;this.initialEntries&&this.initialEntries.length||(this.initialEntries=e),e.forEach(function(e){var i=Number(e.target.getAttribute("data-video-id")),n=t.allInstance[i];if(t.setVideoInterViewRatio(i,e.intersectionRatio),n){var o,r,a,s,l=n.options.intersectionOption.ratio
;if(e.intersectionRatio>=l)(!n.startFindInstanceTime||n.startFindInstanceTime<0)&&(n.startFindInstanceTime=Date.now()),t.inviewVideoIds.indexOf(i)<=-1&&(n.emit("enterView"),t.addInviewKey(i),t.focusedParentDom&&!t.focusedParentDom.contains(n.options.container)&&t.clearPriority());else{if(n.startFindInstanceTime=-1,!R&&(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement))return
;t.inviewVideoIds.indexOf(i)>-1&&(n.emit("leaveView",n),n.destroy(!0),t.currentVideoInstance&&t.currentVideoInstance.videoId===i&&t.setCurrentVideoInstance(null),o=t.inviewVideoIds,r=i,(a=o.findIndex(function(e){return e===r}))>-1&&o.splice(a,1))}le&&!t.isNoteController&&t.formatOrder(null==(s=t.currentVideoInstance)?void 0:s.videoId)}})},t.updateCanPlayQueue=function(e){var t=this;if(e){var i=this.allInstance[e].options.container.getBoundingClientRect();this.inviewVideoIds.forEach(function(n){
if(e!==n){var o=t.allInstance[n].options.container.getBoundingClientRect();o.top!==i.top?t.canPlayQueue[n]=o.top>i.top?1:0:t.canPlayQueue[n]=o.left>i.left?1:0}else t.canPlayQueue[n]=1})}else this.inviewVideoIds.forEach(function(e){t.canPlayQueue[e]=1})},t.formatOrder=function(e){for(var t=this.inviewVideoIds.length,i=0;i<t-1;i++)for(var n=0;n<t-1-i;n++)if(!h(this.allInstance,this.allVideoInterViewRatio,this.inviewVideoIds[n],this.inviewVideoIds[n+1],e)){
var o=[this.inviewVideoIds[n+1],this.inviewVideoIds[n]];this.inviewVideoIds[n]=o[0],this.inviewVideoIds[n+1]=o[1]}this.updateCanPlayQueue(this.inviewVideoIds[0])},t.pageScrollStart=function(){this.isNoteController||(this.beforeScrollVideoId=this.currentVideoInstance&&!this.currentVideoInstance.paused&&this.currentVideoInstance.videoId||0)},t.pageScrollUp=function(){var e=this;if(!this.isNoteController&&1===this.allVideoInterViewRatio[this.beforeScrollVideoId]){
var t=this.inviewVideoIds.findIndex(function(t){if(1!==e.allVideoInterViewRatio[t])return!1;var i=e.allInstance[e.beforeScrollVideoId].options.container,n=e.allInstance[t].options.container,o=i.getBoundingClientRect();return n.getBoundingClientRect().top-o.top>10});t>-1&&(this.updateCanPlayQueue(this.inviewVideoIds[t]),this.findNextPlayVideo())}},t.pageScrollDown=function(){this.isNoteController||(this.formatOrder(),this.findNextPlayVideo())},e}());return he}),
define("@baidu/video-controller",["@baidu/video-controller/lib/videoController"],function(e){return e});