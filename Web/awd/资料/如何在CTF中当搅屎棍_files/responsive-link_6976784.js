!function(t,e){"function"==typeof define&&define.amd?define("@baidu/responsive-link/dist/index",[],e):"object"==typeof exports?module.exports=e():t.ResponsiveLink=e()}(this,function(){"use strict";function t(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){
h(t,e,i[e])})}return t}function e(t,e){return r(t)||n(t,e)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function n(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}function r(t){if(Array.isArray(t))return t}function o(t){
return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(){return s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},s.apply(this,arguments)}function a(t,e){
if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,i){return e&&l(t.prototype,e),i&&l(t,i),t}function h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var c=!1,d=null;window.addEventListener("scroll",function(t){c=!0,
clearTimeout(d),d=setTimeout(function(){c=!1},200)},!1);var f={};document.documentElement.addEventListener("touchstart",function(t){clearTimeout(f.timer),f={};var e=t.changedTouches[0],i=e.pageX,n=e.pageY;f.x0=i,f.y0=n},!1),document.documentElement.addEventListener("touchmove",function(t){var e=t.changedTouches[0],i=e.pageX,n=e.pageY;if(!f.direction){var r=f,o=r.x0,s=r.y0;f.d1=Math.abs((n-s)/(i-o)),f.direction=f.d1>1?"v":"h"}},!1),document.documentElement.addEventListener("touchend",function(t){
"h"===f.direction&&(c=!0,f.timer=setTimeout(function(){c=!1},2500))},!1);var k={START_DELAY:function(){var t=navigator.userAgent.toLowerCase();return t.indexOf("iphone os")>-1&&(t.indexOf("mqqbrowser")>-1||t.indexOf("micromessenger")>-1)?20:50}(),CLICK_KEEP_TIME:1500,START_KEEP_TIME:2e3,END_EXTRA_DELAY:100},p={root:"body",zIndex:99},v={position:"0,0,0,0",color:"rgba(0, 0, 0, .05)",radius:"0"},m="rl-root",y={SHOW:0,HIDE:1},g={INIT:0,STARTED:1,STOPED:2,DESTROYED:3
},_="touchstart touchmove touchend touchcancel click",b="pageshow tf_touchReset",E=function(){function i(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(a(this,i),this.opt=s({},p,e),this.$root="object"===o(this.opt.root)?this.opt.root:document.querySelector(this.opt.root),this.$root&&!this.$root.hasAttribute(m)){this.$root.setAttribute(m,""),this.$mask=document.createElement("div"),this.$mask.setAttribute("data-responsive-link-mask",""),
this.$mask.style.cssText="position: absolute; visibility: hidden; z-index: ".concat(this.opt.zIndex,";                                    pointer-events: none; background: transparent;"),this.$maskInner=document.createElement("div"),this.$maskInner.style.cssText="position: absolute; pointer-events: none;",this.$mask.appendChild(this.$maskInner);var n={touchstart:this._onStart,touchmove:this._onMove,touchend:this._onEnd,touchcancel:this._onCancel,click:this._onClick,pageshow:this._onPageShow,
tf_touchReset:this._onTfReset};this.domHandler=function(e){var i=n[e.type];i&&i.call(t,e)},this.rlState=g.INIT}}return u(i,[{key:"start",value:function(){this.rlState!==g.INIT&&this.rlState!==g.STOPED||(this._bind(),this.rlState=g.STARTED)}},{key:"stop",value:function(){this.rlState===g.STARTED&&(this.targetStart=null,this._hideMask(),this._clearTimer(),this._unbind(),this.$mask.parentNode&&this.$mask.parentNode.removeChild(this.$mask),this.maskNode=this.maskState=null,
this.resNode=this.resType=null,this.rlState=g.STOPED)}},{key:"destroy",value:function(){this.rlState!==g.DESTROYED&&(this.rlState===g.STARTED&&this.stop(),this.$root&&this.$root.removeAttribute(m),this.$root=this.opt=this.domHandler=null,this.$mask=this.$maskInner=null,this.rlState=g.DESTROYED)}},{key:"_bind",value:function(){var t=this;_.split(" ").forEach(function(e){t.$root.addEventListener(e,t.domHandler,!1)}),b.split(" ").forEach(function(e){window.addEventListener(e,t.domHandler,!1)})}},{
key:"_unbind",value:function(){var t=this;_.split(" ").forEach(function(e){t.$root.removeEventListener(e,t.domHandler)}),b.split(" ").forEach(function(e){window.removeEventListener(e,t.domHandler)})}},{key:"_onPageShow",value:function(t){t.persisted&&this._hideMask()}},{key:"_onTfReset",value:function(t){this._hideMask()}},{key:"_onStart",value:function(t){var e=this;if(this.targetStart=t.target,c)return void(c=!1);var i=this._getNode(t.target);i&&(this.resNode=i,this.resType=this._getType(i),
"stop"!==this.resType&&(clearTimeout(this.timerStart),this.timerStart=setTimeout(function(){!c&&e._showMask(i,k.START_KEEP_TIME)},k.START_DELAY)))}},{key:"_onEnd",value:function(t){var e=this;"button"===this.resType&&(clearTimeout(this.timerEnd),this.timerEnd=setTimeout(function(){e._hideMask()},k.START_DELAY+k.END_EXTRA_DELAY))}},{key:"_onMove",value:function(t){this._hideMask()}},{key:"_onCancel",value:function(t){this._hideMask()}},{key:"_onClick",value:function(t){
var e=this,i=this._getNode(t.target);if(this.targetStart&&t.target!==this.targetStart)return t.stopPropagation(),t.preventDefault(),this.targetStart.click(),void(this.targetStart=null);this.targetStart=null,i&&"link"===this._getType(i)&&(this._showMask(i,k.CLICK_KEEP_TIME),this._getATag(t.target)||setTimeout(function(){var n=e._getLinkProps(i);if(n.href){var r=e._createLinkEle(n,i);t.defaultPrevented&&r.addEventListener("click",function(t){t.preventDefault()},!1),
e.$link&&e.$link.parentNode&&e.$link.parentNode.removeChild(e.$link),e.$link=r,e.$root.appendChild(e.$link),r.click()}},0))}},{key:"_showMask",value:function(t){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500;if(t){if(this.maskState===y.SHOW){if(this.maskNode===t)return;this._hideMask(this.maskNode)}if(this.maskState=y.SHOW,this.maskNode=t,clearTimeout(this.timerHide),this.timerHide=setTimeout(function(){i._hideMask(t)},n),this._dispatch(t,"rlShow")){
var r=this._getMaskContainer(t);if("static"===getComputedStyle(r).position&&(r.style.position="relative"),t===r)this.$mask.style.top=0,this.$mask.style.left=0,this.$mask.style.right=0,this.$mask.style.bottom=0,this.$mask.style.removeProperty("width"),this.$mask.style.removeProperty("height");else{var o=t.getBoundingClientRect(),s=r.getBoundingClientRect();this.$mask.style.top=o.top-s.top+"px",this.$mask.style.left=o.left-s.left+"px",this.$mask.style.height=o.height+"px",
this.$mask.style.width=o.width+"px",this.$mask.style.removeProperty("right"),this.$mask.style.removeProperty("bottom")}this.$mask.style.visibility="visible";var a=this._getHighlightProps(t),l=a.position,u=a.color,h=a.radius,c=l.split(","),d=e(c,4),f=d[0],k=d[1],p=d[2],v=d[3];this.$maskInner.style.top=f,this.$maskInner.style.left=v,this.$maskInner.style.bottom=p,this.$maskInner.style.right=k,this.$maskInner.style.backgroundColor=u,this.$maskInner.style.borderRadius=h,r.appendChild(this.$mask)}}}
},{key:"_hideMask",value:function(){this.maskState===y.SHOW&&this.maskNode&&(this._dispatch(this.maskNode,"rlHide")&&(this.$mask.style.visibility="hidden"),this.maskState=y.HIDE)}},{key:"_clearTimer",value:function(){[this.timerStart,this.timerEnd,this.timerHide].forEach(function(t){clearTimeout(t)}),this.timerStart=this.timerEnd=this.timerHide=null}},{key:"_dispatch",value:function(t,e){var i=new Event(e,{bubbles:!0,cancelable:!0});return t&&t.dispatchEvent(i)}},{key:"_isResNode",
value:function(t){return t&&(t.hasAttribute("rl-node")||t.hasAttribute("rl-type"))}},{key:"_getNode",value:function(t){for(var e=t,i=null;e&&e!==this.$root.parentNode;){if(!i&&this._isResNode(e)&&(i=e),e.hasAttribute(m))return e===this.$root?i:null;e=e.parentNode}return null}},{key:"_getType",value:function(t){return t?t.getAttribute("rl-type")||"link":"link"}},{key:"_getHighlightProps",value:function(t){if(!t)return{};var e={};return Object.keys(v).forEach(function(i){
var n=t.getAttribute("rl-highlight-"+i);n&&(e[i]=n)}),s({},v,e)}},{key:"_getGlobalInvokeControl",value:function(){var t,e="1";return this.opt.invokeApps&&(t=this.opt.invokeApps.control&&this.opt.invokeApps.control[110],this.opt.invokeApps.rule&&(e=this.opt.invokeApps.rule[110])),{pos:110,rule:e,control:t}}},{key:"_getNewSrcid",value:function(t){if(t)return t.hasAttribute("new_srcid")?t.getAttribute("new_srcid"):this._getNewSrcid(t.parentNode)}},{key:"_isCanInvoke",value:function(t){
var e=this._getGlobalInvokeControl().control;if(!e)return!1;var i=this._getNewSrcid(t);if(!i)return!1;var n={};return n=e.ext&&"string"==typeof e.ext?JSON.parse(e.ext):e.ext||{},!!Array.isArray(n.whitelist)&&n.whitelist.some(function(t){return t===i})}},{key:"_addInvokeProps",value:function(e,i){return i&&!i["data-ivk"]&&i.href&&this._isCanInvoke(e)?t({},i,{"data-ivk":JSON.stringify(this._getGlobalInvokeControl())}):i}},{key:"_getLinkProps",value:function(t){if(!t)return{}
;for(var e={},i=t.attributes,n=0;n<i.length;n++){var r=i[n],o=r.name,s=r.value;0===o.indexOf("rl-link-")&&(e[o.replace("rl-link-","")]=s)}return e=this._addInvokeProps(t,e)}},{key:"_getMaskContainer",value:function(t){return t&&t.hasAttribute("rl-highlight-self")?t:this.$root}},{key:"_createLinkEle",value:function(t){var e=document.createElement("a");return Object.keys(t).forEach(function(i){e.setAttribute(i,t[i])}),e.setAttribute("rl-type","stop"),e.setAttribute("data-nolog",""),
e.setAttribute("rl-link-node-a",""),e.style.display="none",e}},{key:"_getATag",value:function(t){for(;t&&t!==this.$root;){if("A"===t.nodeName)return t;t=t.parentNode}return null}}],[{key:"getLinkProp",value:function(t,e){return t.getAttribute("rl-link-"+e)}},{key:"setLinkProp",value:function(t,e,i){return t.setAttribute("rl-link-"+e,i)}}]),i}();return h(E,"TYPE_STOP","stop"),h(E,"TYPE_LINK","link"),h(E,"TYPE_BUTTON","button"),h(E,"EVENT_SHOW","rlShow"),h(E,"EVENT_HIDE","rlHide"),E}),
define("@baidu/responsive-link",["@baidu/responsive-link/dist/index"],function(t){return t});